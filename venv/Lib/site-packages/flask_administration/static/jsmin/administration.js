(function(){var a,b,c,d,e,f,g,h,i,j=Object.prototype.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},l=function(a,b){return function(){return a.apply(b,arguments)}};a=jQuery,b="http://127.0.0.1:5000/admin",h={},f={},i={},g={},d={templates:{},get:function(a,b){var c;a.replace("#",""),c=this.templates[a],c?b(c):this.fetch(a+".html",b);if(_(this.name).endsWith("html"))return this.fetch(a,b)},fetch:function(b,c){var d=this;return a.ajax("/admin/static/views/"+b,{type:"GET",dataType:"html",error:function(b,c,d){return a("body").append("AJAX Error: #{textStatus}")},success:function(b,e,f){return d.template=_.template(a(b).html()),c(d.template)}})}},c=_.extend({},Backbone.Events),e=function(){function a(a){this.timezone="UTC",this.nowLocal=new Date,this.nowUTC=new Date(this.nowLocal.getUTCFullYear(),this.nowLocal.getUTCMonth(),this.nowLocal.getUTCDate(),this.nowLocal.getUTCHours(),this.nowLocal.getUTCMinutes(),this.nowLocal.getUTCSeconds()),this.tz(this.timezone)}return a.prototype.current_tz_offset=function(){var a,b;return a=new Date,b=a.getTimezoneOffset()/60},a.prototype.tz=function(a){switch(a){case"PST":this.offset=-8;break;case"MST":this.offset=-7;break;case"CST":this.offset=-6;break;case"EST":this.offset=-5}return this},a.prototype.nowString=function(){var a,b,c,d,e,f;return this.timezone==="UTC"?d=this.nowUTC:(e=this.nowUTC.getTime()+36e5*this.offset,d=new Date(e)),a=d.getHours(),c=d.getMinutes(),f=d.getSeconds(),b=a<12?"AM":"PM",a>12&&(a-=12),a===0&&(a=12),c<10&&(c="0"+c),f<10&&(f="0"+f),""+a+":"+c+":"+f+" "+b},a}(),h.Gauge=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return k(b,a),b}(Backbone.Model),h.Dashboard=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return k(b,a),b}(Backbone.Model),f.Gauges=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return k(b,a),b.prototype.model=h.Gauge,b.prototype.initialize=function(a){return this.url=a.url},b}(Backbone.Collection),f.Dashboards=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return k(b,a),b.prototype.model=h.Dashboard,b.prototype.initialize=function(a){return this.url=a.url},b}(Backbone.Collection),i.GaugeView=function(b){function c(){c.__super__.constructor.apply(this,arguments)}return k(c,b),c.prototype.tagName="div",c.prototype.template=_.template(a("#gauge-template").html()),c.prototype.initialize=function(a){return this.nid=a.nid,this.parent=a.parent,_.bindAll(this,"render"),this},c.prototype.render=function(){var b=this;return d.get("gauge-template",function(c){return b.parent.collections.gauges.fetch({success:function(){var d;return d=b.parent.collections.gauges.get(b.nid).attributes.data,b.$el.html(a(c({id:b.nid,data:d}))),b.$el.draggable({snap:"#main"})}})}),this},c}(Backbone.View),i.TimeView=function(b){function d(){this.update=l(this.update,this),d.__super__.constructor.apply(this,arguments)}return k(d,b),d.prototype.template=_.template(a("#gauge-timeline-template").html()),d.prototype.timezoneInteger=0,d.prototype.initialize=function(b){var d=this;return this.nid=b.nid,this.parent=b.parent,this.timeElement=a("#time-"+this.nid),this.parent.collections.gauges.fetch({success:function(){d.tz=d.parent.collections.gauges.get(d.nid).get("timezone");switch(d.tz){case"EST":d.timezoneInteger=-5;break;case"PST":d.timezoneInteger=-8}return c.on("tick:rtc",d.update)}}),this},d.prototype.update=function(){var b;return b=new e({timezone:this.tz}),a("#time-"+this.nid).text(b.nowString())},d}(i.GaugeView),i.TimelineView=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return k(b,a),b}(i.GaugeView),i.Dashboard=function(b){function d(){this.incrementTick=l(this.incrementTick,this),this.startRTC=l(this.startRTC,this),d.__super__.constructor.apply(this,arguments)}return k(d,b),d.prototype.ticks=0,d.prototype.views=[],d.prototype.collections={dashboards:new f.Dashboards({url:"/admin/dashboard/load"}),gauges:new f.Gauges({url:"/admin/dashboard/gauge/"})},d.prototype.initialize=function(b){var c=this;this.el=a(b.el),_.bindAll(this,"render");try{function(){return c.Jugs=new Juggernaut,c.hasJugs=!0}}catch(d){function(){return console.log(d),c.hasJugs=!1}}return this.startTimerOrChannel(b),this},d.prototype.startTimerOrChannel=function(a){return this.hasJugs?(this.startRTC(),this.openChannel(a.channel)):this.incrementTick()},d.prototype.openChannel=function(a){return this.Jugs.subscribe(a,function(a){return c.trigger(chanelName,a)})},d.prototype.startRTC=function(){return this._interval=window.setTimeout(this.startRTC,1e3),c.trigger("tick:rtc"),this},d.prototype.incrementTick=function(){return this._interval=window.setTimeout(this.incrementTick,500),this.ticks%2===0&&c.trigger("tick:rtc"),this.ticks++,this},d.prototype.render=function(){var b=this;return a("#js-loading").remove(),this.views=[],this.el.empty(),this.collections.dashboards.map(function(a){var c,d,e,f,g,h;return e=a.get("gauge"),f=a.get("id"),h=i[e.type],c="#gauge-"+f,g=new h({parent:b,nid:f,id:c}),d=g.render().el,b.el.append(d),b.views.push(g)}),this},d.prototype.preRender=function(){var a=this;return this.collections.dashboards.fetch({success:function(){return a.render()}})},d}(Backbone.View),a(function(){var b;return b=new i.Dashboard({el:a("#main")}),b.preRender()})}).call(this),define("administration",function(){})